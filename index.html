<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Terra Signal ‚Äî Climate Intelligence System</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  background:#020617;
  color:#e5e7eb;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  padding: 28px;
}
h1,h2,h3 { color:#7dd3fc; margin-bottom:6px; }
p { color:#cbd5f5; }
section {
  border:1px solid #1f2937;
  border-radius:16px;
  padding:20px;
  margin-bottom:26px;
}
input, textarea, button {
  width:100%;
  padding:12px;
  margin-top:10px;
  border-radius:12px;
  border:1px solid #334155;
  background:#020617;
  color:#e5e7eb;
}
button {
  background:#0284c7;
  font-weight:600;
  cursor:pointer;
}
button:hover { background:#0369a1; }
.output {
  margin-top:16px;
  white-space:pre-wrap;
  line-height:1.7;
  font-size:15px;
}
.chatbox {
  max-height:340px;
  overflow-y:auto;
  border:1px solid #334155;
  border-radius:12px;
  padding:12px;
}
.msg { margin-bottom:14px; }
.user { color:#fbbf24; }
.ai { color:#7dd3fc; }
small { color:#9ca3af; }
.footer {
  font-size:12px;
  color:#9ca3af;
  text-align:center;
  margin-top:30px;
}
</style>
</head>

<body>

<h1>üåç Terra Signal</h1>
<p>
A research-grade climate intelligence system that interprets environmental stress
through transparent physical signals ‚Äî not black-box prediction.
</p>

<section>
<h2>üå¶ Regional Climate Signal Analysis</h2>
<input id="locationInput" placeholder="City, region, or country (e.g., Houston, Texas)" />
<button onclick="runAnalysis()">Analyze Region</button>
<div id="climateOut" class="output"></div>
</section>

<section>
<h2>üí¨ Conversational Climate Reasoning</h2>
<div id="chat" class="chatbox"></div>
<textarea id="chatInput" placeholder="Ask about flooding mechanisms, drought stress, soil behavior, or long-term climate risk"></textarea>
<button onclick="sendChat()">Send</button>
</section>

<section>
<h2>üî¨ Scientific Validity & Methodology</h2>
<div class="output">
Terra Signal performs interpretable environmental inference using publicly available
meteorological signals rather than deterministic prediction models.

Core signals:
‚Ä¢ Temperature maxima and thermal persistence
‚Ä¢ Precipitation accumulation and variability
‚Ä¢ Coupled heat‚Äìmoisture stress heuristics

Inferences describe *mechanisms* (e.g., soil saturation, evapotranspiration stress,
runoff accumulation), not event forecasts.

Limitations:
‚Ä¢ No subsurface soil maps or land-use classification
‚Ä¢ No hydrodynamic simulation
‚Ä¢ Outputs are probabilistic and explanatory, not warnings
</div>
</section>

<div class="footer">
Terra Signal ‚Äî Climate Intelligence Research Prototype
</div>

<script>
let session = {
  location: null,
  coords: null,
  climate: null,
  stressProfile: null
};

// ---------- Utilities ----------
function avg(arr) {
  return arr.reduce((a,b)=>a+b,0)/arr.length;
}
function variance(arr) {
  const m = avg(arr);
  return avg(arr.map(x => (x - m) ** 2));
}

// ---------- Geocoding ----------
async function geocode(place) {
  const r = await fetch(
    `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(place)}&count=3`
  );
  const j = await r.json();
  return j.results && j.results.length ? j.results[0] : null;
}

// ---------- Analysis ----------
async function runAnalysis() {
  const out = document.getElementById("climateOut");
  out.textContent = "Extracting environmental signals‚Ä¶";

  const place = document.getElementById("locationInput").value.trim();
  if (!place) {
    out.textContent = "Please enter a location.";
    return;
  }

  const geo = await geocode(place);
  if (!geo) {
    out.textContent = "Unable to resolve location. Try city + country.";
    return;
  }

  const url =
    `https://api.open-meteo.com/v1/forecast?latitude=${geo.latitude}&longitude=${geo.longitude}&daily=temperature_2m_max,precipitation_sum&timezone=auto`;

  const r = await fetch(url);
  const d = await r.json();

  const temps = d.daily.temperature_2m_max;
  const rain = d.daily.precipitation_sum;

  const avgTemp = avg(temps);
  const avgRain = avg(rain);
  const tempVar = variance(temps);
  const rainVar = variance(rain);

  // Stress inference
  let thermalStress = avgTemp > 32 ? "high" : avgTemp > 26 ? "moderate" : "low";
  let moistureStress = avgRain < 2 ? "dry" : avgRain > 10 ? "saturated" : "balanced";

  let compoundRisk = "moderate";
  if (thermalStress === "high" && moistureStress === "dry") compoundRisk = "drought-prone";
  if (thermalStress === "high" && moistureStress === "saturated") compoundRisk = "flood-prone";

  session = {
    location: `${geo.name}, ${geo.country}`,
    coords: { lat: geo.latitude, lon: geo.longitude },
    climate: { avgTemp, avgRain, tempVar, rainVar },
    stressProfile: { thermalStress, moistureStress, compoundRisk }
  };

  out.textContent =
`Location: ${session.location}
Coordinates: ${geo.latitude.toFixed(2)}, ${geo.longitude.toFixed(2)}

Mean Daily Max Temperature: ${avgTemp.toFixed(1)} ¬∞C
Mean Daily Precipitation: ${avgRain.toFixed(1)} mm

Temperature Variability Index: ${tempVar.toFixed(2)}
Precipitation Variability Index: ${rainVar.toFixed(2)}

Environmental Stress Profile:
‚Ä¢ Thermal Stress: ${thermalStress}
‚Ä¢ Moisture Regime: ${moistureStress}
‚Ä¢ Compound Risk State: ${compoundRisk.toUpperCase()}

Interpretation:
Persistent climate signals interact with soil moisture dynamics, surface runoff,
and evapotranspiration. Variability indices indicate stability vs. volatility
in environmental stressors rather than single extreme events.`;
}

// ---------- Conversational Reasoning ----------
function sendChat() {
  const chat = document.getElementById("chat");
  const input = document.getElementById("chatInput");
  const q = input.value.trim();
  if (!q) return;

  chat.innerHTML += `<div class="msg user">You: ${q}</div>`;
  input.value = "";

  let reply = "Terra Signal reasoning:\n\n";

  if (!session.location) {
    reply +=
      "No region analyzed yet. Run a regional climate analysis to ground this discussion in environmental data.";
  } else {
    const s = session.stressProfile;
    const c = session.climate;

    reply +=
`Region: ${session.location}
Thermal Stress: ${s.thermalStress}
Moisture Regime: ${s.moistureStress}
Compound Risk: ${s.compoundRisk}

`;

    const t = q.toLowerCase();

    if (t.includes("flood")) {
      reply +=
"Flood susceptibility arises when precipitation accumulation exceeds infiltration capacity. Elevated rainfall combined with thermal stress can reduce soil cohesion, increasing surface runoff and delayed inundation.";
    } else if (t.includes("drought")) {
      reply +=
"Drought stress emerges from sustained thermal load and suppressed precipitation. High temperatures accelerate evapotranspiration, depleting soil moisture and stressing vegetation systems.";
    } else if (t.includes("soil")) {
      reply +=
"Soil response depends on moisture persistence, compaction, and organic content. Climate stress alters infiltration rates, erosion potential, and long-term land stability.";
    } else if (t.includes("trend") || t.includes("future")) {
      reply +=
"Long-term climate trends amplify baseline stress states. Regions with existing thermal or moisture imbalance tend to experience nonlinear increases in hazard sensitivity.";
    } else {
      reply +=
"This question relates to how climate signals propagate into environmental stress. Terra Signal explains mechanisms rather than issuing deterministic predictions.";
    }
  }

  chat.innerHTML += `<div class="msg ai">${reply}</div>`;
  chat.scrollTop = chat.scrollHeight;
}
</script>

</body>
</html>
